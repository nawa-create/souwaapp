# 残業時間・手当計算ロジック

## 基本設定

| 項目 | 値 |
|------|-----|
| 所定労働時間 | 8時間 |
| 深夜帯（通常） | 22:15〜5:00 |
| 深夜帯（5時前開始） | 22:00〜5:00 |
| 早出帯 | 5:00〜22:15 |

---

## 曜日別ルール

| 曜日 | 残業計算 | 内深夜 |
|------|---------|--------|
| 平日 | 8時間超が残業 | あり |
| 土曜 | 8時間超が残業 | あり |
| 祝日 | **全て残業** | なし |
| 法定休日 | **全て残業** | なし |

---

## 残業の種類と単価

| 種類 | 条件 | 単価 |
|------|------|------|
| 内深夜 | 所定内 × 深夜帯 | +300円 |
| 早出時間 | 残業 × 早出帯（平日） | ×1.0 |
| 深夜時間 | 残業 × 深夜帯（平日） | ×1.5 |
| 土曜時間 | 残業 × 早出帯（土曜） | ×1.25 |
| 土曜深夜 | 残業 × 深夜帯（土曜） | ×1.5 |
| 祝日時間 | 残業 × 早出帯（祝日） | ×1.25 |
| 祝日深夜 | 残業 × 深夜帯（祝日） | ×1.5 |
| 法定休日時間 | 残業 × 早出帯（法定休日） | ×1.35 |
| 法定休日深夜 | 残業 × 深夜帯（法定休日） | ×1.6 |

---

## 休憩の扱い

| 休憩 | 意味 | 終業時刻の扱い |
|------|------|----------------|
| +（プラス） | 休憩1時間未満（例: +0:15 → 実休憩45分） | そのまま |
| -（マイナス） | 休憩1時間超過（例: -0:30 → 実休憩1:30） | 差分を差し引く |

### 実労働時間の計算

```
拘束時間 = 終了時刻 - 開始時刻
実休憩時間 = 1時間 - プラス分 または 1時間 + マイナス分
実労働時間 = 拘束時間 - 実休憩時間
```

### 休憩マイナス時の深夜帯判定

休憩マイナスの場合、終業時刻からマイナス分を差し引いた時刻を基準に深夜帯を判定する。

例: 14:00〜23:30（休憩-0:30）
- 実質終業時刻 = 23:00（23:30 - 0:30）
- 深夜帯判定は 22:15〜23:00 = 0:45

---

## 計算の優先順位（平日・土曜）

深夜帯に勤務がある場合：

1. 残業があれば → まず **深夜時間** に計上
2. 深夜帯の残り → **内深夜** に計上（所定内分）
3. 残業の残り → **早出時間/土曜時間** に計上

### 例: 平日、4:00〜13:15（休憩1時間）= 実働8時間15分

- 深夜帯（4:00〜5:00）= 1時間
- 残業 = 15分
- → **深夜時間 0:15**（残業分を深夜帯に優先割当）
- → **内深夜 0:45**（深夜帯の残り、所定内分）

---

## 祝日・法定休日の計算

全ての勤務時間が残業扱いのため、内深夜は発生しない。

### 例: 祝日、4:00〜12:00（休憩1時間）= 実働7時間

- 全て残業
- 4:00〜5:00 = **祝日深夜 1:00**
- 5:00〜12:00（休憩除く）= **祝日時間 6:00**

---

## 乗り換え時間

乗り換え時間は、その曜日の残業時間に加算される。

| 曜日 | 乗り換え時間の計上先 |
|------|---------------------|
| 平日 | 早出時間 |
| 土曜 | 土曜時間 |
| 祝日 | 祝日時間 |
| 法定休日 | 法定休日時間 |

---

## 車泊

- 時間計算には影響なし
- 車泊手当が1回分加算される

---

## 具体例

### 例1: 平日、8:00〜18:15（休憩1時間）= 実働9時間15分

- 残業 = 1:15
- 全て早出帯（5:00〜22:15）
- → **早出時間 1:15**

### 例2: 平日、8:00〜23:30（休憩1時間）= 実働14時間30分

- 残業 = 6:30
- 22:15〜23:30 = 1:15（深夜帯）
- → **深夜時間 1:15**
- → **早出時間 5:15**

### 例3: 平日、4:00〜14:30（休憩1時間）= 実働9時間30分

- 4:00〜5:00 = 深夜帯 1時間
- 残業 = 1:30
- → **深夜時間 1:00**（残業を深夜帯に優先割当）
- → **早出時間 0:30**（残業の残り）
- 内深夜 = 0（深夜帯は残業で使い切り）

### 例4: 平日、4:00〜12:00（休憩1時間）= 実働7時間

- 4:00〜5:00 = 深夜帯 1時間
- 残業 = 0
- → **内深夜 1:00**（所定内の深夜帯）

### 例5: 土曜、4:00〜12:00（休憩1時間）= 実働7時間

- 4:00〜5:00 = 深夜帯 1時間
- 残業 = 0
- → **内深夜 1:00**（土曜でも8時間以内なら内深夜）

### 例6: 祝日、4:00〜12:00（休憩1時間）= 実働7時間

- 全て残業扱い
- → **祝日深夜 1:00**
- → **祝日時間 6:00**

### 例7: 平日、5:00〜13:45（休憩+1:00）= 実働8時間45分

- 5:00開始なので深夜帯は22:15〜5:00
- 残業 = 0:45
- 勤務時間内に深夜帯なし
- → **早出時間 0:45**

### 例8: 平日、14:00〜23:30（休憩-0:30）= 実働8時間

- 実質終業 = 23:00
- 残業 = 0
- 22:15〜23:00 = 深夜帯 0:45
- → **内深夜 0:45**

### 例9: 平日、14:00〜23:30（休憩+0:15）= 実働8時間45分

- 終業 = 23:30のまま
- 残業 = 0:45
- 22:15〜23:30 = 深夜帯 1:15
- → **深夜時間 0:45**（残業分）
- → **内深夜 0:30**（所定内の深夜分）
