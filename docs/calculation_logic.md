# 残業時間・手当計算ロジック

## 基本設定

| 項目 | 値 |
|------|-----|
| 所定労働時間 | 8時間 |
| 休憩基準 | 1時間 |
| 深夜帯（通常） | 22:15〜5:00 |
| 深夜帯（5時前開始） | 22:00〜5:00 |
| 早出帯 | 5:00〜22:15 |

---

## 残業の計算方法

### 重要: 残業は「終了時刻」で判断する

```
基準終了時刻 = 開始時刻 + 9時間（所定8時間 + 休憩基準1時間）
残業時間 = 終了時刻 - 基準終了時刻（マイナスなら0）
```

※休憩の過不足は残業時間に影響しない。終了時刻のみで判断。

### 例

| 開始 | 終了 | 休憩 | 基準終了 | 残業 |
|------|------|------|----------|------|
| 4:00 | 13:00 | なし | 13:00 | 0 |
| 4:00 | 13:30 | なし | 13:00 | 30分 |
| 4:00 | 14:00 | 1時間 | 13:00 | 1時間 |
| 4:00 | 14:30 | 1時間 | 13:00 | 1.5時間 |
| 4:00 | 12:30 | +1:00 | 13:00 | 0 |

---

## 曜日別ルール

| 曜日 | 残業計算 | 内深夜 |
|------|---------|--------|
| 平日 | 終了 - (開始+9時間) | あり |
| 土曜 | 終了 - (開始+9時間) | あり |
| 祝日 | **全て残業** | なし |
| 法定休日 | **全て残業** | なし |

---

## 残業の種類と単価

| 種類 | 条件 | 単価 |
|------|------|------|
| 内深夜 | 所定内 × 深夜帯 | +300円 |
| 早出時間 | 残業 × 早出帯（平日） | ×1.0 |
| 深夜時間 | 残業 × 深夜帯（平日） | ×1.5 |
| 土曜時間 | 残業 × 早出帯（土曜） | ×1.25 |
| 土曜深夜 | 残業 × 深夜帯（土曜） | ×1.5 |
| 祝日時間 | 残業 × 早出帯（祝日） | ×1.25 |
| 祝日深夜 | 残業 × 深夜帯（祝日） | ×1.5 |
| 法定休日時間 | 残業 × 早出帯（法定休日） | ×1.35 |
| 法定休日深夜 | 残業 × 深夜帯（法定休日） | ×1.6 |

---

## 休憩の扱い

| 休憩 | 意味 | 終業時刻の扱い |
|------|------|----------------|
| +（プラス） | 休憩1時間未満（例: +0:15 → 実休憩45分） | そのまま |
| -（マイナス） | 休憩1時間超過（例: -0:30 → 実休憩1:30） | 深夜帯判定時に差分を差し引く |

### 休憩と残業の関係

- **残業時間の計算には休憩は影響しない**
- 残業は純粋に「終了時刻 - (開始+9時間)」で決まる
- 休憩マイナスの場合のみ、深夜帯の判定で終業時刻を調整

---

## 計算の優先順位（平日・土曜）

深夜帯に勤務がある場合：

1. 残業があれば → まず **深夜時間** に計上
2. 深夜帯の残り → **内深夜** に計上（所定内分）
3. 残業の残り → **早出時間/土曜時間** に計上

### 例: 平日、4:00〜13:30（休憩なし）

- 基準終了 = 13:00
- 残業 = 30分
- 深夜帯（4:00〜5:00）= 1時間
- → **深夜時間 0:30**（残業分を深夜帯に優先割当）
- → **内深夜 0:30**（深夜帯の残り、所定内分）

### 例: 平日、4:00〜14:30（休憩1時間）

- 基準終了 = 13:00
- 残業 = 1.5時間
- 深夜帯（4:00〜5:00）= 1時間
- → **深夜時間 1:00**（残業を深夜帯に優先割当）
- → **早出時間 0:30**（残業の残り）
- 内深夜 = 0（深夜帯は残業で使い切り）

---

## 祝日・法定休日の計算

全ての勤務時間が残業扱いのため、内深夜は発生しない。

### 例: 祝日、4:00〜12:00（休憩1時間）= 実働7時間

- 全て残業
- 4:00〜5:00 = **祝日深夜 1:00**
- 5:00〜12:00（休憩除く）= **祝日時間 6:00**

---

## 乗り換え時間

乗り換え時間は、その曜日の残業時間に加算される。

| 曜日 | 乗り換え時間の計上先 |
|------|---------------------|
| 平日 | 早出時間 |
| 土曜 | 土曜時間 |
| 祝日 | 祝日時間 |
| 法定休日 | 法定休日時間 |

---

## 車泊

- 時間計算には影響なし
- 車泊手当が1回分加算される

---

## 具体例

### 例1: 平日、8:00〜18:15（休憩1時間）

- 基準終了 = 17:00
- 残業 = 1:15
- 全て早出帯（5:00〜22:15）
- → **早出時間 1:15**

### 例2: 平日、8:00〜23:30（休憩1時間）

- 基準終了 = 17:00
- 残業 = 6:30
- 22:15〜23:30 = 1:15（深夜帯）
- → **深夜時間 1:15**
- → **早出時間 5:15**

### 例3: 平日、4:00〜14:30（休憩1時間）

- 基準終了 = 13:00
- 残業 = 1:30
- 4:00〜5:00 = 深夜帯 1時間
- → **深夜時間 1:00**（残業を深夜帯に優先割当）
- → **早出時間 0:30**（残業の残り）
- 内深夜 = 0（深夜帯は残業で使い切り）

### 例4: 平日、4:00〜12:00（休憩なし）

- 基準終了 = 13:00
- 残業 = 0
- 4:00〜5:00 = 深夜帯 1時間
- → **内深夜 1:00**（所定内の深夜帯）

### 例5: 平日、4:00〜12:30（休憩+1:00）

- 基準終了 = 13:00
- 残業 = 0（終了12:30 < 基準13:00）
- 4:00〜5:00 = 深夜帯 1時間
- → **内深夜 1:00**（休憩不足でも残業にならない）

### 例6: 土曜、4:00〜12:00（休憩1時間）

- 基準終了 = 13:00
- 残業 = 0
- 4:00〜5:00 = 深夜帯 1時間
- → **内深夜 1:00**（土曜でも8時間以内なら内深夜）

### 例7: 祝日、4:00〜12:00（休憩1時間）

- 全て残業扱い
- → **祝日深夜 1:00**
- → **祝日時間 6:00**

### 例8: 平日、5:00〜13:45（休憩+1:00）

- 基準終了 = 14:00
- 残業 = 0（終了13:45 < 基準14:00）
- 5:00開始なので深夜帯は22:15〜5:00
- 勤務時間内に深夜帯なし
- → 全て0

### 例9: 平日、14:00〜23:30（休憩-0:30）

- 基準終了 = 23:00
- 残業 = 0:30
- 深夜帯判定用の終業時刻 = 23:00（23:30 - 0:30）
- 22:15〜23:00 = 深夜帯 0:45
- → **深夜時間 0:30**（残業分）
- → **内深夜 0:15**（所定内の深夜分）

### 例10: 平日、14:00〜23:30（休憩+0:15）

- 基準終了 = 23:00
- 残業 = 0:30
- 深夜帯判定用の終業時刻 = 23:30（そのまま）
- 22:15〜23:30 = 深夜帯 1:15
- → **深夜時間 0:30**（残業分）
- → **内深夜 0:45**（所定内の深夜分）
